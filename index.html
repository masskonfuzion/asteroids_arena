<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
</head>

<script src="src/gl-matrix.js" type="text/javascript"></script>
<script src="src/application.js" type="text/javascript"></script>
<script src="src/image_manager.js" type="text/javascript"></script>
<script src="src/game_object.js" type="text/javascript"></script>

<script type="text/javascript">
var game = new GameApplication(512, 512);   // Global scope
var imgMgr = new ImageManager();
var frameID = null;

function mainEntryPoint() {
    game.initialize();

    var imgAsset_spaceship = new ImageAsset("assets/images/spaceship_03.png");
    imgMgr.addImgToMap("ship", imgAsset_spaceship);

    imgMgr.initialize();

    start();
}

function start()
{
    console.log("Starting");
    //if (!gApp.started) {
    //    gApp.started = true; // started is like a first-time-through flag. We care about started really only one time (at the very beginning of execution)
    //    frameID = requestAnimationFrame(function(timestamp) {
    //        gApp.drawScene(gameLogic);    // Do initial draw, dummy frame just to get timestamp and such
    //        gApp.running = true; // running is a flag to determine whether or not the mainloop is running
    //        gApp.frameID = requestAnimationFrame(mainLoop);
    //    });
    //}

    frameID = requestAnimationFrame(mainloop);
    console.log("Started");
}


function stop()
{
    console.log("Stopping");

    //gApp.running = false;
    //gApp.started = false;
    //cancelAnimationFrame(gApp.frameID);

    console.log("Stopped");
}

function mainloop()
{
    // TODO replace/modify mainloop to support the State pattern
    drawStuff();
    frameID = requestAnimationFrame(mainloop);
}

function drawStuff()
{
    // TODO the mainloop will call into the active State's functions (callbacks? No.. probably not; instead, each state will be its own object, with its own internal logic)
    var imgMap = imgMgr.imageMap;
    for (key in imgMap) {
        if (imgMap.hasOwnProperty(key)) {
            var imgObj = imgMap[key].imgObj;
            if (imgObj.loadedByGame) {
                console.log("Drawing " + key);
                game.context.drawImage(imgObj, 30, 100);    // TODO soon, we'll stop hard-coding render locations
            }
        }
    }
}

</script>

<body onload="mainEntryPoint()">
    <canvas id="canvas" width="512" height="512">Sorry, something went wrong... (But what was it.....?)</canvas>
    <p>WTF tho</p>
</body>

</html>

